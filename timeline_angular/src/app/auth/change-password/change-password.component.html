<app-main-bar></app-main-bar>
<div class="container mt-5">
  @if (successMessage) {
  <div class="alert alert-success">
    {{ successMessage }}
  </div>
  }
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">Zmień hasło</div>
        <div class="card-body">
          <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
            <div class="mb-3">
              <label for="current_password" class="form-label">Aktualne hasło</label>
              <input id="current_password" type="password" class="form-control" formControlName="current_password"
                [ngClass]="{'is-invalid': changePasswordForm.get('current_password')?.invalid && changePasswordForm.get('current_password')?.touched}"
                autocomplete="current-password">
              @if (changePasswordForm.get('current_password')?.errors?.['required'] &&
              changePasswordForm.get('current_password')?.touched) {
              <div class="invalid-feedback">
                Aktualne hasło jest wymagane
              </div>
              }
            </div>
            <div class="mb-3">
              <label for="new_password" class="form-label">Nowe hasło</label>
              <input id="new_password" type="password" class="form-control" formControlName="new_password"
                [ngClass]="{'is-invalid': changePasswordForm.get('new_password')?.invalid && changePasswordForm.get('new_password')?.touched}"
                autocomplete="new-password">
              @if (changePasswordForm.get('new_password')?.errors?.['required'] &&
              changePasswordForm.get('new_password')?.touched) {
              <div class="invalid-feedback">
                Nowe hasło jest wymagane
              </div>
              }
              @if (changePasswordForm.get('new_password')?.errors?.['minlength'] &&
              changePasswordForm.get('new_password')?.touched) {
              <div class="invalid-feedback">
                Hasło musi zawierać:
                <ul class="mb-0">
                  <li>Przynajmniej jedną wielką literę</li>
                  <li>Przynajmniej jedną małą literę</li>
                  <li>Przynajmniej jedną cyfrę</li>
                  <li>Przynajmniej jeden znak specjalny (&#64;$!%*?&)</li>
                </ul>
              </div>
              }
            </div>
            <div class="mb-3">
              <label for="new_password_confirmation" class="form-label">Potwierdź nowe hasło</label>
              <input id="new_password_confirmation" type="password" class="form-control"
                formControlName="new_password_confirmation"
                [ngClass]="{'is-invalid': changePasswordForm.errors?.['mismatch'] && changePasswordForm.get('new_password_confirmation')?.touched}"
                autocomplete="new-password">
              @if (changePasswordForm.errors?.['mismatch'] &&
              changePasswordForm.get('new_password_confirmation')?.touched) {
              <div class="invalid-feedback">
                Hasła nie są takie same
              </div>
              }
            </div>
            <div class="mb-0">
              <button type="submit" class="btn btn-primary" [disabled]="changePasswordForm.invalid">
                Zmień hasło
              </button>
            </div>
          </form>
          @if (errorMessage) {
          <div class="alert alert-danger mt-3">
            {{ errorMessage }}
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>